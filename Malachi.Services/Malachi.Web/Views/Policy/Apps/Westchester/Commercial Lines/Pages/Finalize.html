<div class="row">
    <div class="col-md-8">
      <form name="form" class="form-horizontal" role="form" id="submission-form" style="margin-top: 30px;">
        <div class="alert alert-danger" role="alert" ng-show="ErrorMessage.length > 0">{{ErrorMessage}}</div>
        <div class="alert alert-warning" role="alert" ng-show="WarningMessage.length > 0">{{ErrorMessage}}</div>

        <div class="form-group">
          <label class="col-sm-3 control-label">Account Executive<span style="color: red;"> *</span></label>
          <div class="col-sm-9">
            <ui-select ng-model="parent.Policy.UnderwriterId"
                       append-to-body="true"
                       theme="bootstrap"
                       ng-disabled="!parent.canModify()"
                       ng-change="accountExecSelected()"
                       reset-search-input="false">
              <ui-select-match placeholder="Select an Account Exec">{{$select.selected.Name}}</ui-select-match>
              <ui-select-choices repeat="value.Id as value in AccountExecutives | filter: $select.search">
                <div ng-bind-html="value.Name | highlight: $select.search">
                </div>
              </ui-select-choices>
            </ui-select>
          </div>
        </div>

        <div class="form-group">
          <label class="col-sm-3 control-label">Office <span style="color: red;"> *</span></label>
          <div class="col-sm-9">
            <ui-select ng-model="parent.Policy.OfficeId"
                       append-to-body="true"
                       theme="bootstrap"
                       ng-disabled="!parent.canModify()"
                       reset-search-input="false">
              <ui-select-match placeholder="Select an office">{{$select.selected.Name}}</ui-select-match>
              <ui-select-choices repeat="value.Id as value in Offices | filter: $select.search">
                <div ng-bind-html="value.Name | highlight: $select.search">
                </div>
              </ui-select-choices>
            </ui-select>
          </div>
        </div>

        <div class="form-group">
          <label class="col-sm-3 control-label">MEP<span style="color: red;"> *</span></label>
          <div class="col-sm-9">
            <ui-select ng-model="parent.Policy.MinimumEarnedPremium"
                       append-to-body="true"
                       theme="bootstrap"
                       ng-disabled="!parent.canModify() || parent.policy.Endorsement != null"
                       reset-search-input="false"
                       search-enabled="false">
              <ui-select-match placeholder="Select Minimum Earned Premium">{{$select.selected}}</ui-select-match>
              <ui-select-choices repeat="value in MinimumEarnedPremiums | filter: $select.search">
                <div ng-bind-html="value | highlight: $select.search">
                </div>
              </ui-select-choices>
            </ui-select>
          </div>
        </div>

        <div class="form-group" ng-if="parent.Policy.EndorsementNumber">
          <label class="col-sm-3 control-label">Retail Agency Name<span style="color: red;"> *</span></label>
          <div class="col-sm-9">
            <ui-select ng-model="parent.Policy.CurrentAgencyId"
                       append-to-body="true"
                       theme="bootstrap"
                       reset-search-input="false"
                       ng-disabled="!parent.canModify()"
                       ng-change="agencySelected()">
              <ui-select-match placeholder="Search Agency">
                    <div ng-bind-html="getAgencyName($select.selected.Name,$select.selected.Code,$select.selected.PhysicalAddress.City,$select.selected.PhysicalAddress.StateCode,$select.selected.PhysicalAddress.ZipCode)"/>
                </ui-select-match> <!-- CHANGE TO NAME -->
              <ui-select-choices repeat="value.Id as value in Agencies | filter: $select.search">
                  <div ng-bind-html="value.Name + ' - ' + value.Code + ' - ' + value.PhysicalAddress.City  + ', ' +  value.PhysicalAddress.StateCode  + ' ' + value.PhysicalAddress.ZipCode | highlight: $select.search">
                  </div>
              </ui-select-choices>
            </ui-select>
          </div>
        </div>

        <div class="form-group" ng-if="parent.Policy.EndorsementNumber">
          <label class="col-sm-3 control-label">Agent Contact<span style="color: red;"> *</span></label>
          <div class="col-sm-9">
            <ui-select ng-model="parent.Policy.CurrentAgencyContactId"
                       append-to-body="true"
                       theme="bootstrap"
                       reset-search-input="false"
                       ng-disabled="!parent.canModify()">
              <ui-select-match placeholder="Select Agent">{{$select.selected.Name + ($select.selected.Email ? ' - ' + $select.selected.Email : '')}}</ui-select-match>
              <ui-select-choices repeat="value.Id as value in getContacts() | filter: $select.search">
                <div ng-bind-html="value.Name + (value.Email ? ' - ' + value.Email : '') | highlight: $select.search">
                </div>
              </ui-select-choices>
            </ui-select>
          </div>
        </div>

        <div class="form-group" ng-if="parent.Policy.EndorsementNumber">
          <label class="col-sm-3 control-label">Licensed Agent<span style="color: red;"> *</span></label>
          <div class="col-sm-9">
            <ui-select ng-model="parent.Policy.ProducingAgencyLicense"
                       append-to-body="true"
                       theme="bootstrap"
                       reset-search-input="false"
                       ng-disabled="!parent.canModify()">
              <ui-select-match placeholder="Select Licensed Agent">{{$select.selected.LicenseeName + ($select.selected.LicenseNumber ? ' - ' + $select.selected.LicenseNumber : '')}}</ui-select-match>
              <ui-select-choices repeat="value.LicenseNumber as value in LicensedAgents | filter: $select.search">
                <div ng-bind-html="value.LicenseeName + (value.LicenseNumber ? ' - ' + value.LicenseNumber : '') | highlight: $select.search"></div>
              </ui-select-choices>
            </ui-select>
          </div>
        </div>

        <div class="form-group" ng-if="!parent.Policy.EndorsementNumber">
          <label class="col-sm-3 control-label">Retail Agency Name<span style="color: red;"> *</span></label>
          <div class="col-sm-9" >
            <ui-select ng-model="parent.Policy.OriginalAgencyId"
                       append-to-body="true"
                       theme="bootstrap"
                       reset-search-input="false"
                       ng-disabled="!parent.canModify()"
                       ng-change="agencySelected()">
                <ui-select-match placeholder="Search Agency">
                    <div ng-bind-html="getAgencyName($select.selected.Name,$select.selected.Code,$select.selected.PhysicalAddress.City,$select.selected.PhysicalAddress.StateCode,$select.selected.PhysicalAddress.ZipCode)"/>
                </ui-select-match> <!-- CHANGE TO NAME -->
              <ui-select-choices repeat="value.Id as value in Agencies | filter: $select.search">
                <div ng-bind-html="value.Name + ' - ' + value.Code + ' - ' + value.PhysicalAddress.City  + ', ' +  value.PhysicalAddress.StateCode  + ' ' + value.PhysicalAddress.ZipCode | highlight: $select.search">
                </div>
              </ui-select-choices>
            </ui-select>
          </div>
        </div>

        <div class="form-group" ng-if="!parent.Policy.EndorsementNumber">
          <label class="col-sm-3 control-label">Agent Contact<span style="color: red;"> *</span></label>
          <div class="col-sm-9">
            <ui-select ng-model="parent.Policy.OriginalAgencyContactId"
                       append-to-body="true"
                       theme="bootstrap"
                       reset-search-input="false"
                       ng-disabled="!parent.canModify()">
              <ui-select-match placeholder="Select Agent">{{$select.selected.Name + ($select.selected.Email ? ' - ' + $select.selected.Email : '')}}</ui-select-match>
              <ui-select-choices repeat="value.Id as value in getContacts() | filter: $select.search">
                <div ng-bind-html="value.Name + (value.Email ? ' - ' + value.Email : '') | highlight: $select.search">
                </div>
              </ui-select-choices>
            </ui-select>
          </div>
        </div>

        <div class="form-group">
          <label class="col-sm-3 control-label" style="padding-left: 0px;">Retail Agency Commission<span style="color: red;"> *</span></label>
          <div class="col-sm-9">
            <input type="text" ng-model="parent.Policy.ProducingAgencyCommission" class="form-control" ng-disabled="!parent.canModify()">
          </div>
        </div>
      </form>

    <form name="form" class="form-horizontal" role="form" id="submission-form">
      <div class="form-group" style="margin-left: 0px;">
        <label class="form-label"><strong>Underwriting Requirements & Subjectivities</strong></label>
        <textarea class="form-control" ng-model="parent.Policy.CurrentVersion.Subjectivities" ng-disabled="parent.Policy.Issued || parent.isAwaitingElanyApproval()" style="height: 200px; resize: none;"></textarea>
      </div>
    </form>

  </div>

  <div class="col-md-4">
    <div ng-disabled="!parent.canModify()" ng-if="parent.Policy.Endorsement == null" style="margin-top: 30px;">
      <div style="margin-top: 9px; padding: 9px 8px 8px 8px; background-color: #16216c; color: white;"><strong>{{getRiskCompanyName(parent.Policy.CurrentVersion.FocusedRiskCompanyId)}}</strong></div>
      <table class="table table-condensed-tight" style="margin-top: 10px; margin-bottom: 10px;">
        <tbody id="premium-details-table" ng-repeat="premium in parent.Policy.CurrentVersion.Premiums" ng-if="premium.RiskCompanyId == parent.Policy.CurrentVersion.FocusedRiskCompanyId && !isCustomPackageRiskCompany(parent.Policy.CurrentVersion.FocusedRiskCompanyId)">
          <tr>
            <td style="padding-left: 4px; padding-right: 4px; font-size: 1.1em"><strong>Total Premium</strong></td>
            <td style="padding-left: 4px; padding-right: 4px; font-size: 1.1em"><strong>{{premium.PremiumAfterFeesAndTaxes | currency}}</strong></td>
          </tr>
          <tr ng-repeat="breakdown in premium.Breakdown | orderBy:'Index'">
            <td style="padding: 4px">{{breakdown.Name}}</td>
            <td style="padding: 4px">
              {{breakdown.Amount | currency}}
              <div ng-if="breakdown.Name == 'Policy Fee' && parent.Policy.HomeStateCode == 'TX'" class="pull-right" style="display: inline-block;">TX 50/50</div>
              <input ng-if="breakdown.Name == 'Policy Fee' && parent.Policy.HomeStateCode == 'TX'" type="checkbox" ng-disabled="Policy.Bound" ng-checked="IsTexasSplit" ng-click="addRemoveTexasSplit()" class="pull-right" style="margin-right: 4px; margin-top: 2px;">
            </td>
          </tr>
        </tbody>

        <!-- CUSTOM PACKAGE -->

        <tbody id="premium-details-table" ng-repeat="premium in parent.Policy.CurrentVersion.Premiums" ng-if="premium.RiskCompanyId == parent.Policy.CurrentVersion.FocusedRiskCompanyId && isCustomPackageRiskCompany(parent.Policy.CurrentVersion.FocusedRiskCompanyId)">
          <tr>
            <td style="padding-left: 4px; padding-right: 4px; font-size: 1.1em"><strong>Total Premium</strong></td>
            <td style="padding-left: 4px; padding-right: 4px; font-size: 1.1em"><strong>{{premium.PremiumAfterFeesAndTaxes | currency}}</strong></td>
          </tr>
          <tr ng-repeat="breakdown in premium.Breakdown | orderBy:'Index'">
            <td style="padding: 4px">
              <div class="pull-left">{{breakdown.Name}}</div>
              <div ng-if="getCustomPackageCoverageRiskCompanyShortName(breakdown.Coverage, premium.RiskCompanyId)" class="pull-left font-blue-sharp" style="display: inline-block;">&nbsp;({{getCustomPackageCoverageRiskCompanyShortName(breakdown.Coverage, premium.RiskCompanyId)}})</div>
            </td>
            <td style="padding: 4px">
              {{breakdown.Amount | currency}}
              <div ng-if="breakdown.Name == 'Policy Fee' && parent.Policy.HomeStateCode == 'TX'" class="pull-right" style="display: inline-block;">TX 50/50</div>
              <input ng-if="breakdown.Name == 'Policy Fee' && parent.Policy.HomeStateCode == 'TX'" type="checkbox" ng-disabled="Policy.Bound" ng-checked="IsTexasSplit" ng-click="addRemoveTexasSplit()" class="pull-right" style="margin-right: 4px; margin-top: 2px;">
            </td>
          </tr>
        </tbody>

        <!-- END -->

      </table>
      <div class="row form-group" ng-show="showInspectionType()">
        <label class="col-sm-4 control-label" style="padding-top: 7px">Inspection Type</label>
        <div class="col-sm-8">
          <ui-select ng-model="parent.Policy.InspectionType"
                     append-to-body="true"
                     theme="bootstrap"
                     on-select="inspectionTypeSelected()"
                     ng-disabled="!parent.canModify() || parent.policy.Endorsement != null"
                     reset-search-input="false"
                     search-enabled="false">
            <ui-select-match placeholder="Select an inspection type">{{$select.selected.Name}}</ui-select-match>
            <ui-select-choices repeat="inspectionType.Value as inspectionType in InspectionTypes | filter: $select.search">
              <div ng-bind-html="inspectionType.Name | highlight: $select.search"></div>
            </ui-select-choices>
          </ui-select>
        </div>
      </div>

      <div class="row" style="margin-bottom: 10px;">
        <div class="col-sm-12">
          <button ng-if="parent.PolicyId != null" type="submit" class="btn yellow-casablanca pull-right"
                  ng-hide="parent.Policy.Issued || parent.isAwaitingElanyApproval() || !canUpdateFees" ng-click="editFees()">
            Edit Fees
          </button>
        </div>
      </div>

    </div>
    <div class="row" ng-show="Errors.length > 0" style="margin-left: 0px;">
      <div class="alert alert-danger">
        <ul>
          <li ng-repeat="error in Errors | unique">
            {{error}}
          </li>
        </ul>
      </div>
    </div>
  </div>

</div>

<div class="row" *ngIf="parent.policy.Endorsement == null">
  <div class="col-md-8">
    <div class="form-group" ng-show="canShowMultipleLocationsToInspect()">
      <label class="col-sm-4 control-label" style="padding-top: 7px">Locations to inspect: </label>

      <div class="col-sm-6">
        <ui-select ng-model="locationToInspectSelected.value" ng-disabled="!parent.canModify()"
                   append-to-body="true"
                   theme="bootstrap"
                   reset-search-input="false"
                   search-enabled="true">
          <ui-select-match placeholder="Select a location or Building">
            <span><b>{{$select.selected.location.LocationNumber}}</b></span>
            <span ng-if="$select.selected.building"><b>-{{$select.selected.building.BuildingNumber}}</b></span>
            <span style="margin-left:5px">{{$select.selected.location.Address.ShortAddress}}</span>
          </ui-select-match>
          <ui-select-choices repeat="location in (locationAvailableToInspect | filter: {location: { Address: { ShortAddress : $select.search } } })">
            <span><b>{{location.location.LocationNumber}}</b></span>
            <span ng-if="location.building"><b>-{{location.building.BuildingNumber}}</b></span>
            <span style="margin-left:5px">{{location.location.Address.ShortAddress}}</span>
          </ui-select-choices>
        </ui-select>
      </div>

      <button style="margin-top:0px" ng-disabled="!parent.canModify()" ng-if="parent.PolicyId != null" type="submit" class="col-md-2 btn yellow-casablanca pull-right"
              ng-hide="parent.Policy.Issued || parent.isAwaitingElanyApproval() || !canUpdateFees" ng-click="onAddLocationToInspect()">
        Add
      </button>

    </div>
    <!--  --> 
  </div> 
</div>

<div class="row">
  <div class="col-md-8" style="margin-top: 20px;">
    <ul class="list-group">
      <li style="padding: 10px;" class="list-group-item" ng-repeat="loc in LocationsToInspect">
        <span><strong>Location {{loc.location.LocationNumber}}</strong></span>
        <span ng-if="loc.building"><strong>- {{loc.building.BuildingNumber}}</strong></span>
        <span>{{loc.location.Address.ShortAddress}}</span>
        <button ng-disabled="!parent.canModify()" ng-hide="parent.Policy.Issued" style="margin-top:-9px;" class="btn btn-link pull-right" ng-click="removeLocationToInspect(loc)">
          <span class="glyphicon glyphicon-trash"></span>
        </button>

      </li>
    </ul>
  </div>
  <div class="col-md-4"></div>
</div>

<div class="row">
  <div class="col-md-12">
    <button ng-if="parent.PolicyId != null" type="submit" class="btn yellow-casablanca pull-right" ng-hide="parent.Policy.Issued || parent.isAwaitingElanyApproval()" ng-click="saveChanges()">Save Changes</button>
  </div>

  <div class="col-md-12" ng-if="EndorsementActivityGroups.length > 0">
    <h2>Endorsement Activities</h2>
    <table></table>
  </div>
</div>


<script type="text/ng-template" id="editFees.html">
  <div class="modal-header">
    <h4 class="modal-title">Edit Fees</h4>
  </div>

  <div class="modal-body">
    <div class="row">
      <div class="col-sm-12">
        <table class="table table-condensed-tight" style="margin-top: 30px;">
          <tbody id="premium-details-table">
            <tr ng-repeat="breakdown in EditableFees | orderBy:'Index'">
              <td style="padding-top:15px; width:30%;">
                {{breakdown.Name}}
              </td>
              <td>
                <div class="input-group pull-right" style="width:70%;">
                  <span class="input-group-addon">$</span>
                  <input class="form-control input-sm" style="width:60%;" type="text" ng-disabled="!parent.canModify()" data-mask="#" ng-model="breakdown.Amount" />
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="row" ng-show="Errors.length > 0">
      <div class="col-md-12">
        <div class="alert alert-danger">
          <ul>
            <li ng-repeat="error in Errors">
              {{error}}
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="modal-push">
    </div>
  </div>
  <div class="modal-footer">
    <div id="modalProperty_commands">
      <button id="modalProperty_close" type="button" data-dismiss="modal" class="btn btn-default" ng-click="close()">Close</button>
      <button id="modalProperty_ok" type="button" class="btn yellow-casablanca" ng-click="add()">Update</button>
    </div>
  </div>
</script>
